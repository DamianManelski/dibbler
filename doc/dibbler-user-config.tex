%%
%% Dibbler - a portable DHCPv6
%%
%% authors: Tomasz Mrugalski <thomson@klub.com.pl>
%%
%%
%% released under GNU GPL v2 licence
%%
%% $Id: dibbler-user-config.tex,v 1.25 2006-09-03 09:49:08 thomson Exp $
%%

\section{Configuration files}

This section describes Dibbler server and (optional) client
configuration. Square brackets denotes optional values: mandatory
[optional]. Alternative is marked as $\mid$. A $\mid$ B means A or
B. Parsers are case-insensitive, so Iface, IfAcE, iface and IFACE mean
the same. This does not apply to interface names, of course. eth0 and
ETH0 are dwo diffrent interfaces.

\subsection{Tokens and basic informations}
Config file parsing is token-based. Token can be considered a keyword
or a specific phrase. Here's list of tokens used:
\begin{description}
\item[IPv6 address] -- IPv6 address 
\item[32-bit decimal integer] -- string containing only numbers, e.g. 123456
\item[string] -- string of arbitrary characters enclosed in single or double
  quotes, e.g. 'this is string'. If string contains only a-z, A-Z and
  0-9 characters, quotes can be omited.
\item[DUID identifier] -- hex number starting with 0x, e.g. 0x12abcd.
\item[IPv6 address list] -- IPv6 addresses separated with commas.
\item[DUID list] -- DUIDs separated with commas.
\item[string list] -- strings separated with comas.
\item[boolean] -- YES, NO, TRUE, FALSE, 0 or 1. Each of them can be
  used, when user must enable or disable specific option.
\end{description}

\subsection{Scopes}
There are four scopes, in which options can be specified: global,
inteface, IA and address.

Global scope is the largest. It covers the whole config file and
applies to all intefaces, IAs, and addresses, unless some lower scope
options override it. Next comes inteface scope. Options defined there
are inteface-specific and apply to this interface, all IAs in this
interface and addresses in those IAs. Next is IA scope. Options
defined there are IA-specific and apply to this IA and to addresses it
contains. Least significant scope is address. Every option is specific
for one scope. For example, T1 is defined for
IA scope. However, it can be also used in more common scopes. In this
case -- in interface or global. Defining T1 in interface scope means:
,,for this interface default value for T1 is ...''. The same applies
to global scope. Options can be used multiple times. In that case
value defined later is used.

\subsection{Comments}

Comments are also allowed. All common comment styles are supported:
\begin{itemize}
\item C++ style one-line comments: // this is comment
\item C style multi-line comments: /* this is multiline comment */
\item bash style one-line comments: \# this is one-line comment
\end{itemize}

\subsection{Client configuration file}

Client config file should be named \verb+client.conf+. It should be
placed in the +/etc/dibbler/+ directory (Linux system) or in the
current directory (Windows systems). After successful startup, old
version of this file is stored as \verb+client.conf-old+. One of
design requirements for client was ,,out of the box'' usage. To
achieve this, simply use empty 
\verb+client.conf+ file. Client will try to get one address for each up and
running interface \footnote{Exactly: Client tries to configure each
  up, multicast-capable and running interface, which has link address
  at least 6 bytes long. So it will not configure tunnels (which
  usually have IPv4 address (4bytes long) as their link address. It
  should configure all Ethernet and 802.11 interfaces. The latter was
  not tested by author due to lack of access to 802.11 equipment.}.

\subsubsection{Global scope}

Every option can be declared in global scope.
Config file has this form:

\begin{verbatim}
interface declaration
global options
interface options
IA options
address options
\end{verbatim}

\subsubsection{Interface declaration}

Interface can be declared this way:
\begin{verbatim}
iface interface_name
{
  interface options
  IA options
  address options        
}
\end{verbatim}

or 

\begin{verbatim}
iface number 
{
  interface options
  IA options
  address options        
}
\end{verbatim}

In every case, number denotes interface number. It can be extracted
from ,,ip~l'' (Linux) or
,,ipv6~if'' (Windows). \verb+interface_name+ is an interface
name.  Also take a note that name of the interface
no longer needs to be enclosed in single or double quotes. It is
necessary only in Windows systems, where interface names sometimes
contain spaces, e.g. ''local network connection''.

\subsubsection{IA declaration}

IA is a short for Identity Association. It is a logical entity
representing address or addresses used to perform some
functions. Almost always, each DHCPv6 client will have exactly one
IA. IA is declared this way:

\begin{verbatim}
ia number
{ 
  address declaration
  IA options
  address options
}
\end{verbatim}

where number is an optional number, which describes how many such IAs
should be requested. Number is optional. If it is not specified, 1 is
used. If this number is not equal 1, then address
options are not allowed. That could come in handy when someone need
serveral IAs with the same parameters. If IA contains no addresses,
client assumes that one address should be configured.

\subsubsection{Address declaration}
Addres is declared like this:

\begin{verbatim}
address number
{ 
  address options
  IPv6 address
}
\end{verbatim}
where number denotes how many addresses with those values should be
requested. If it is diffrent than 1, then IPv6 address options are not
allowed.

\subsubsection{Standard options}
Standard options are... well, standard. This means that they have 
nothing to do with any extensions. Standard options are declared this way:

\begin{verbatim}
OptionName option-value
\end{verbatim}

Every option has a scope it can be used in, default value and
sometimes allowed range. Parameters denoted with (H) are used as hints
for the server. Value of \opt{work-dir} option is currently not
used. In \opt{log-mode} option, \verb+short+ and \verb+full+ values are
supported. \verb+syslog+ and \verb+eventlog+ will be available in
future releases. rapid-commit and unicast expect one boolean
parameter. It can be TRUE, FALSE, YES, NO, 0 or 1. Setting log level
to too low value (5 or less) can result in mysterious behavior. 6 or 7
is a recommended value.

\begin{center}
\begin{tabular}{|c|c|>{\centering}p{1.7cm}<{}|c|p{6cm}|}
\hline
Name              & Scope   & Values     & default    & Description \\
                  &         & (default)  &            & \\
\hline
valid-lifetime    & address & integer    & 4294967296 & valid lifetime for address (specified in seconds) (H)\\
prefered-lifetime & address & integer    & 4294967296 & after this amount of time(in seconds) address becomes depreciated (H)\\
T1                & IA      & integer    & 4294967296 & client should renew addresses after T1 seconds (H)\\
T2                & IA      & integer    & 4294967296 & client should send REBIND after T2 seconds (H)\\
reject-servers    & IA      & addrs or
                             DUID list  & empty      & list containing servers which should be discarded in configuration of this IA \\
prefered-servers  & IA      & addrs or 
                             DUID list  & empty      & Prefered servers list. ADVERTISE messages received by client are sorted according to this list. \\
rapid-commit      &interface& 0 or 1     & 0          & should we use Rapid Commit? \\
unicast           &interface& 0 or 1     & 0          & Is unicast communication allowed? \\
work-dir          & global  & string     & empty      & working directory \\
log-level         & global  & 1-8        & 8          & log-level (8 is most verbose) \\
log-name          & global  & string     & Client     & Name, which appears in a log file\\
log-mode          & global  &short or full& full      & logging mode: short (date and name suppressed) or full. \\
strict-rfc-no-routing &global& none      & none       & if this option
is present, routing will not be configured \\
\hline
\end{tabular}
\end{center}

\subsubsection{Addional options}
Additional options are the options specified in external drafts and in RFC
documents. They are declared with \verb+option+ keyword:

\begin{verbatim}
option OptionName option-value
\end{verbatim}

where OptionName is one of possible values listed below:

\begin{center}
\begin{tabular}{|c|c|>{\centering}p{1.7cm}<{}|c|p{6cm}|}
\hline
OptionName     & Scope    & Values      &default& Description \\
               &          & (default)   &       & \\
\hline
dns-server     & interface& addrs list  & not defined & preferred DNS servers list (H) \\
domain         & interface&domains list & not defined & preferred domain (H)\\
ntp-server     & interface& addrs list  & not defined & preferred NTP servers list (H)\\
time-zone      & interface& timezone    & not defined & preferred time zone (H)\\
sip-server     & interface& addrs list  & not defined & preferred SIP servers list (H)\\
sip-domain     & interface&domains list & not defined & preferred SIP domain (H)\\
nis-server     & interface& addrs list  & not defined & preferred NIS servers list (H)\\
nis-domain     & interface& domain      & not defined & preferred NIS domain (H)\\
nis+-server    & interface& addrs list  & not defined & preferred NIS+ servers list (H)\\
nis+-domain    & interface& domain      & not defined & preferred NIS+ domain (H)\\
lifetime       & interface& YES/NO      & no    & Should client request lifetime option? \\
\hline
\end{tabular}
\end{center}

Note that timezone format is described in file \verb+draft-ietf-dhc-dhcpv6-opt-tz-00.txt+
and domain format is described in RFC 3646. After receiving options
values from a server, client stores them in separate files in the
working directory, e.g. \verb+option-dns-server+. Several options
are processed and set up in the system. Options supported in Linux and
Windows environments are presented in the table below.

\begin{center}
\begin{tabular}{|l|l|l|l|}
\hline
Option & Linux & WinXP/2003 & WinNT/2000  \\
\hline
dns-server  & system, file & system, file & system,file \\
domain      & file         & system, file & file \\
ntp-server  & file         & file & file \\
time-zone   & file         & file & file \\
sip-server  & file         & file & file \\
sip-domain  & file         & file & file \\
nis-server  & file         & file & file \\
nis-domain  & file         & file & file \\
nis+-server & file         & file & file \\
nis+-domain & file         & file & file \\
\hline
\end{tabular}
\end{center}

\subsubsection{Stateless configuration}

If interface does not contain \verb+IA+ keyword, one IA with one address is
assumed. If client should not request for address on this interface,
\opt{stateless}\footnote{In the version 0.2.1-RC1 and earlier, this
  directive was called no-ia. This depreciated name is valid for now,
  but might be removed in future releases.}
must be used. In such circumstances, only specified options will be
requested.

\subsubsection{Relay support}
Usage of the relays is not visible from the client's point of view:
Client can't distinguigh if it communicates via relay(s) or directly
with the server. Therefore no special directives on the client side 
are required to use relays. 

\subsection{Client configuration examples}
This subsection contains various examples of the most configurations.
If you are interested in additional examples, download source version
and look at \verb+*.conf+ files.

\subsubsection{Example 1: Default}

In simplest case, client config can be empty. Client will try to
assign one address for every interface present in the system, except
interfaces:
\begin{itemize}
\item which are down (flag UP not set)
\item loopback (flag LOOPBACK set)
\item which are not running (flag RUNNING not set)
\item which are not multicast capable (flag MULTICAST not set)
\end{itemize}

If you must use DHCPv6 on one of such interfaces (which is not
recommended and probably will fail), you must explicitly specify this
interface in config file.

\subsubsection{Example 2: DNS}

Simple config config file requesting 1 address and DNS configuration
on eth0 interface looks like that:
\begin{Verbatim}
# client.conf
log-mode short
log-level 7
iface eth0 {
  option dns-server
  ia
}
\end{Verbatim}

\subsubsection{Example 3: Timeouts and specific address}

Another example is presented below. Client asks for 1 address and
would like it to be 2000::1:2:3. Rapid-commit is allowed and client
would like to renew this address once in a 10 minutes.

\begin{Verbatim}
# client.conf
log-mode short
log-level 7
iface eth0 {
  T1 1800
  T2 2000
  prefered-lifetime 3600
  valid-lifetime 7200
  rapid-commit YES
  ia {
    address { 
      2000::1:2:3
    }
  }
}
\end{Verbatim}

\subsubsection{Example 4: Unicast, more than one address}

Here's yet another example. We would like to obtain 2 addresses on
,,Local Area Connection'' interface. Note quotation marks around
interface name. They're necessary since this particular interface name
contains spaces. Client also would like to accept Unicast
communication if server supports it. We don't care for
details, so keep those log very short. Take note that you won't be
able to what Dibbler is doing with such low log-level. (Preferred
log-level is 7). Config file looks like that:

\begin{Verbatim}
# client.conf
log-mode short
log-level 5
iface "Local Area Connection" {
  unicast yes
  ia 2
}
\end{Verbatim}

\subsubsection{Exmaple 5: Rapid-commit}
Rapid-commit is a shortened exchange with server. It consists of only
two messages, instead of the usual four. Instead of using interface
name, we provide its index. It is worth to know that server must also 
support rapid-commit.

\begin{Verbatim}
# client.conf
iface 3 {
  rapid-commit yes
  ia 
  option dns-server
}
\end{Verbatim}

\subsubsection{Example 6: Stateless mode}
Client can be configured to work in a stateless mode. It means that it
will obtain only some configuration parameters, but no
addresses. Let's assume we want all the details and we want to obtain
all possible configuration parameters. Here is a configuration file:

\begin{Verbatim}
# client.conf
log-level 8
log-mode full
stateless
iface eth0
{
  option dns-server
  option domain
  option ntp-server
  option time-zone
  option sip-server
  option sip-domain
  option nis-server
  option nis-domain
  option nis+-server
  option nis+-domain
}
\end{Verbatim}

\subsubsection{Example 7: Dynamic DNS (FQDN)}
\label{example-client-fqdn}
Dibbler client is able to request fully qualified domain name,
i.e. name, which is fully resolvable using DNS. After receiving such
name, it can perform DNS Update procedure. Client can ask for any
name, without any preferrence. Here is an example how to configure
client to perform such task:
\begin{Verbatim}
# client.conf
log-level 7
iface eth0 {
# ask for address
    ia

# ask for options
   option dns-server
   option domain
   option fqdn
}
\end{Verbatim}
In this case, client will mention that it is interested in FQDN by
using Option Request. Server upon receiving such request (if it is
configured to support it), will provide FQDN option containing domain
name.

It is also possible for client to provide its name as a hint for
server. Server might take it into consideration when it will choose a
name for this client. Example of a configuration file for such
configuration is provided below:

\begin{Verbatim}
# client.conf
log-level 7
iface eth0 {
# ask for address
    ia

# ask for options
   option dns-server
   option domain
   option fqdn zoe.example.com
}
\end{Verbatim}

Note that to successfully perform DNS Update, address must be assigned
and dns server address must be known. So ,,ia'' and ,,option
dns-server'' is required for ,,option fqdn'' to work properly. Also if
DHCPv6 server provides more than one DNS server addresses, update will
be attempted only to the first one on the list.

\subsection{Server configuration file}

Server configuration is stored in \verb+server.conf+ file in the
+/etc/dibbler+ (Linux systems) or in current (Windows systems)
directory. After successful startup, old version of this file is stored as
\verb+server.conf-old+.

\subsubsection{Global scope}

Every option can be declared in global scope.
Config file has this form:

\begin{verbatim}
 interface declaration  |
 global options         |
 interface options      |
 class options          
\end{verbatim}

\subsubsection{Interface declaration}

Interface can be declared this way:
\begin{verbatim}
iface name_of_this_interface
{
  interface options      |
  class options        
}
\end{verbatim}

or 

\begin{verbatim}
iface number 
{
  interface options      |
  class options        
}
\end{verbatim}

where name\_of\_this\_interface denotes name of the interface and
number denotes it's number. It no longer needs to be enclosed in
single or double quotes (except windows cases, when interface name
contains spaces).

\subsubsection{Class scope}
Address class is declared as follows:

\begin{verbatim}
class
{  
     class options |
     address pool    
}
\end{verbatim}

address pool can be defined in one of the following formats:
\begin{verbatim}
pool minaddress-maxaddress
pool address/prefix
\end{verbatim}

\subsubsection{Options}

Every option has a scope it can be used in, default value and
sometimes allowed range.

%% FIXME: this table must be sanitized
\begin{tabular}{|c|c|>{\centering}p{1.7cm}<{}|c|p{6cm}|}
\hline
Name             & Scope   & Values      & default    & Description \\
                 &         & (default)   &  & \\
\hline
work-dir         & global  & string      & empty      & working directory \\
log-level        & global  & 1-8         & 8          & log-level (8 is most verbose) \\
log-name         & global  & string      & Client     & Name, which appears in a log file\\
cache-size       & global  & integer     & 1048576    & size of the
address cache, specified in bytes \\

preference       &interface& 0-255       & 0          & server preference value (higher is more prefered) \\
unicast          &interface& address     & empty      & Specify which address should be used. \\
iface-max-lease  &interface& integer     & 4294967296 & how many addresses can be leased by all clients? \\
client-max-lease &interface& integer     & 4294967296 & how many addresses can be leased by one client? \\
rapid-commit     &interface& 0 or 1      & 0          & should we allow Rapid Commit (SOLICIT--REPLY)? \\
relay            &interface& string      & not defined& Name of the physical interface used to reach this relay \\
interface-id     &interface& integer     & not defined& ID of the relay interface. Must be unique \\

valid-lifetime   & class   & integer     & 4294967296 & valid lifetime for address (specified in seconds)\\
prefered-lifetime& class   & integer     & 4294967296 & after this amount of time(in seconds) address becomes depreciated\\
T1               & class   & integer     & 4294967296 & client should renew addresses after T1 seconds \\
T2               & class   & integer     & 4294967296 & client should send REBIND after T2 seconds\\
reject-clients   & class   & addrs or 
                             DUID list   & empty      & list containing servers which should be discarded in configuration of this IA \\
accept-only      & class   & addrs or
                             DUID list   & empty      & these are the only clients allowed to use this class\\
class-max-lease  & class   & integer     & 4294967296 & how many addresses can be leased from this class? \\
\hline
\end{tabular}

\begin{itemize}
\item[log-mode] -- defines logging level. Currently supported options
  are: full (daemon name, date and time), short (minutes and seconds), precise
  (seconds and microseconds, used mainly for finding bottlenecks). In
  future releases, syslog (unix only) and eventlog (windows only) will
  be supported. Default is full.
\end{itemize}

\subsubsection{Addional options}
Server supports additonal options, not specified in RFC3315. They have
generic form:

\begin{verbatim}
option OptionName OptionsValue
\end{verbatim}

All supported options are specified in the table below:

\begin{center}
\begin{tabular}{|l|l|c|c|l|}
\hline
OptionName       & OptionsValue& Default    & Description \\ \hline
dns-server       & addrs list  & empty      & DNS servers list \\
domain           & string list & empty      & domain names list \\
ntp-server       & addrs list  & empty      & NTP servers list \\
time-zone        & timezone    & empty      & time zone \\
sip-server       & addrs list  & empty      & SIP servers list \\
sip-domain       & string list & empty      & domain names list \\

nis-server       & addrs list  & empty      & NIS servers list \\
nis-domain       & string      & empty      & domain name \\

nisplus-server   & addrs list  & empty      & NIS+ servers list \\
nis-domain       & string      & empty      & domain name \\
lifetime         & integer     & empty      & how often renew options? \\
\hline
\end{tabular}
\end{center}

Lifetime is a special case. It is not set up by client in a system
configuration. It is, however, used by the client to know how long
obtained values are correct.

\subsection{Server configuration examples}

This subsection contains various examples of the server
configuration. If you are interested in additional examples, download source version
and look at \verb+*.conf+ files.


\subsubsection{Example 1: Simple}

In opposite to client, server uses only interfaces described in config
file. Let's examine this common situation: server has interface
named \emph{eth0} (which is fourth interface in the system) and is
supposed to assign addresses from 2000::100/124 class. Simplest config
file looks like that:

\begin{Verbatim}
# server.conf
iface eth0
{ 
  class
  {
    pool 2000::100-2000::10f
  } 
}
\end{Verbatim}

\subsubsection{Example 2: Timeouts}
Server should be configured to deliver specific timer values to the
clients. This example shows how to instruct client to renew (T1 timer) 
addresses one in 10 minutes. In case of problems, ask other servers in
15 minutes (T2 timer), that allowe prefered lifetime range is from 30
minutes to 2 hours, and valid lifetime is from 1 hour to 1 day. DNS
server parameter is also provided. Lifetime option is used to make
clients renew all non-address related options renew once in 2 hours.

\begin{Verbatim}
# server.conf
iface eth0 
{
  T1 600
  T2 900
  prefered-lifetime 1800-3600
  valid-lifetime 3600-86400
  class
  {
    pool 2000::100/80
  } 

  option dns-server 2000::1234
  option lifetime 7200
}
\end{Verbatim}

\subsubsection{Example 3: Limiting amount of addresses}
Another example: Server should support 2000::0/120 class on eth0
interface. It should not allow any client to obtain more than 5
addresses and should not grant more then 50 addresses in total. From
this specific class only 20 addresses can be assigned. Server
preference should be set to 7. This means that this server is more
important than all server with preference set to 6 or less. 
Config file is presented below:

\begin{Verbatim}
# server.conf
iface eth0
{
  iface-max-lease 50
  client-max-lease 5
  preference 7
  class
  {
    class-max-lease 20
    pool 2000::1-2000::100
  }
}  
\end{Verbatim}

\subsubsection{Example 4: Unicast communication}
Here's modified previous example. Instead of specified limits, unicast
communication should be supported and server should listen on
2000::1234 address. Note that default multicast address is still
supported. You must have this unicast address already configured on 
server's interface.

\begin{Verbatim}
# server.conf
log-level 7
iface eth0
{
  unicast 2000::1234
  class
  {
    pool 2000::1-2000::100
  }
}  
\end{Verbatim}

\subsubsection{Example 5: Rapid-commit}
This configuration can be called quick. Rapid-commit is a way to shorten exchange to only two messages. It is
quite useful in networks with heavy load. In case if client does not
support rapid-commit, another trick is used. Preference is set to
maximum possible value. 255 has a special meaning: it makes client to
skip wait phase for possible advertise messages from other servers and
quickly request addresses.

\begin{Verbatim}
# server.conf
log-level 7
iface eth0
{
  rapid-commit yes
  preference 255
  class
  {
    pool 2000::1/112
  }
}  
\end{Verbatim}

\subsubsection{Example 6: Access control}
Administrators can selectively allow certain client to use this
server (white-list). On the other hand, some clients could be
explicitly forbidden to use this server (black-list). Specific DUIDs,
DUID ranges, link-local addresses or the whole address ranges are
supported. Here is config file:

\begin{Verbatim}
# server.conf
iface eth0
{
  class
  {
    # duid of the rejected client
    reject-clients ``00001231200adeaaa''
    2000::2f-2000::20  // it's in reverse order, but it works.
                       // just a trick. 
  }
}
iface eth1
{
  class
  {
    accept-only fe80::200:39ff:fe4b:1abc
    pool 2000::fe00-2000::feff
  }
}
\end{Verbatim}

\subsubsection{Example 7: Multiple classes}
Although this is not common, a few users have requested support for multiple classes on one interface.
Dibbler server can be configured to use several classes. When client asks for an address, one of the classes
is being choosen on a random basis. If not specified otherwise, all classes have equal probability of being chosen.
However, this behavior can be modified using \verb+share+ parameter. In the following example, server supports
3 classes with different preference level: class 1 has 100, class 2 has 200 and class 3 has 300. This means that class 1
gets $\frac{100}{100+200+300} \approx 16\% $ of all requests, class 2
gets $\frac{200}{100+200+300} \approx 33\% $ and class 3 gets the rest 
($\frac{300}{100+200+300}=50\% $).

\begin{Verbatim}
# server.conf
log-level 7
log-mode short

iface eth0 {
 T1 1000
 T2 2000

 class {
   share 100
   pool 4000::1/80
 }
 class {
   share 200
   pool 2000::1-2000::ff
 }

 class {
   share 300
   pool 3000::1234:5678/112
 }
}
\end{Verbatim}

\subsubsection{Example 8: Relay support}
To get more informations about relay configuration, see section \ref{features-relays}.
Following server configuration example explains how to use
relays. There is some remote relay with will send encapsulated data over
eth1 interface. It is configured to append interface-id option set to
5020 value. Let's allow all clients using this relay some addresses
and information about DNS servers:

\begin{Verbatim}
# server.conf
iface relay1 {
  relay eth1
  interface-id 5020
  class {
    pool 2000::1-2000::ff
  }
  option dns-server 2000::100,2000::101
}
\end{Verbatim}

\subsubsection{Example 9: 2 relays}
This is advanced configuration. It assumes that client sends data to
relay1, which encapsulates it and forwards it to relay2, which
eventually sends it to the server (after additional encapsulation). It
assumes that first relay adds interface-id option set to 6011 and
second one adds similar option set to 6021. 

\begin{Verbatim}
# server.conf
iface relay1
{
  relay eth0
  interface-id 6011
} 

iface relay2
{
  relay relay1
  interface-id 6021
  T1 1000
  T2 2000
  class {
    pool 6020::20-6020::ff
  }
}
\end{Verbatim}

\subsubsection{Example 10: Dynamic DNS (FQDN)}
\label{example-server-fqdn}

Support for Dynamid DNS Updates was added recently. To configure it
on the server side, list of available names must be defined. Each name
can be reserved for a certain address or DUID. When no reservation is
specified, it will available to everyone, i.e. the first client asks
for FQDN will get this name. In following example, name 'zebuline.example.com' is
reserved for address 2000::1, kael.example.com is reserved for 2000::2 and
test.example.com is reserved for client using DUID
00:01:00:00:43:ce:25:b4:00:13:d4:02:4b:f5. 

Also note that is required to define, which side can perform updates.
This is done using single number after ,,option fqdn'' phrase. Server
can perform two kinds of DNS Updates: AAAA (forward resolving,
i.e. name to address) and PTR (reverse resolving, i.e. address to
name). To configure server to execute both updates, specify 2. This is
a default behavior. If this value will be skipped, server will attempt
to perform both updates. When 1 will be specified, server will update
PTR record only and will leave updating AAAA record to the
client. When this value is set to 0, server will not perform any
updates.

The last parameter (64 in the following example) is a prefix length of
the reverse domain supported by the DNS server, i.e. if this is set to
64, and 2000::/64 addresses are used, DNS server must support
0.0.0.0.0.0.0.0.0.0.0.0.0.0.2.ip6.arpa. zone.

\begin{Verbatim}
# server.conf
log-level 8
log-mode precise
iface "eth1" {
 prefered-lifetime 3600
 valid-lifetime 7200
 class {
   pool 2000::1-2000::ff
 }

 option dns-server 2000::100,2000::101
 option domain example.com, test1.example.com
 option fqdn 2 64
        zebuline.example.com - 2000::1,
	kael.example.com - 2000::2,
	test.example.com - 0x0001000043ce25b40013d4024bf5,
	zoe.example.com,
	malcolm.example.com,
	kaylee.example.com,
	jayne.example.com
}
\end{Verbatim}

\subsection{Relay configuration file}

Relay configuration is stored in +relay.conf+ file in the +/etc/dibbler/+
(Linux systems) or in current directory (Windows systems).

\subsubsection{Global scope}

Every option can be declared in global scope.
Config file consists of global options and one or more inteface
definitions. Note that reasonable minimum is 2 interfaces, as defining
only one would mean to resend messages on the same interface.

\subsubsection{Interface declaration}

Interface can be declared this way:
\begin{verbatim}
iface name_of_the_interface
{
  interface options
}
\end{verbatim}

or 

\begin{verbatim}
iface number 
{
  interface options
}
\end{verbatim}

where name\_of\_the\_interface denotes name of the interface and
number denotes it's number. It does not need to be enclosed in
single or double quotes (except windows cases, when interface name
contains spaces).

\subsubsection{Options}

Every option has a scope it can be used in, default value and
sometimes allowed range.

%% FIXME: this table must be sanitized
\begin{tabular}{|c|c|>{\centering}p{1.7cm}<{}|c|p{6cm}|}
\hline
Name             & Scope   & Values      & default    & Description \\
                 &         & (default)   &  & \\
\hline
%%work-dir         & global  & string      & empty      & working directory \\
log-level        & global  & 1-8         & 8          & log-level (8 is most verbose) \\
log-name         & global  & string      & Client     & Name, which appears in a log file\\
log-mode         & global  &short or full& full       & logging mode: short (date and name suppressed) or full \\

client multicast &interface& boolean     &            & Client's messages should be received on the multicast address.\\
client unicast   &interface& address     &not defined & Client's messages should be received on the specified multicast address. \\
server multicast &interface& boolean     &            & Forwarded messages should be sent to the multicast address. \\
server unicast   &interface& address     &not defined & Forwarded messages should be send to the specified address. \\
interface-id     &interface& integer     &not defined & Identifier of that particular interface. Used for interface-id option. \\
\hline
\end{tabular}

\vspace{0.5cm}

It is worth mentioning that interface-id should be specified on the
interface, which is used to receive messages from the clients, not the
one used to forward packets to server.

\subsection{Relay configuration examples}

Relay configuration file is fairly simple. Relay forwards DHCPv6
messages between interfaces. Messages from client are encapsulated and
forwarded as RELAY\_FORW messages. Replies from server are received as
RELAY\_REPL message. After decapsulation, they are being sent back to
clients. 

It is vital to inform server, where this relayed message was
received. DHCPv6 does this using interface-id option. This identifier
must be unique. Otherwise relays will get confused when they will
receive reply from server. Note that this id does not need to be
alligned with system interface id (ifindex). Think about it as
"ethernet segment identifier" if you are using Ethernet network or as
"bss identifier" if you are using 802.11 network.

If you are interested in additional examples, download source version
and look at \verb+*.conf+ files.

\subsubsection{Example 1: Unicast/multicast}
Let's assume this case: relay has 2 interfaces: eth0 and
eth1. Clients are located on the eth1 network. Relay should receive
data on that interface using well-known ALL\_DHCP\_RELAYS\_AND\_SERVER
multicast address (ff02::1:2). Relay also listens on its global
address 2000::123. Packets received on the eth1 should be forwarded on
the eth0 interface, also using multicast address:

\begin{Verbatim}
# relay.conf
log-level 8
log-mode short
iface eth0 {
  server multicast yes
}
iface eth1 {
  client multicast yes
  client unicast 2000::123
  interface-id 1000
}
\end{Verbatim}

\subsubsection{Example 2: Multiple interfaces}
Here is another example. This time messages should be forwarded from
eth1 and eth3 to the eth0 interface (using multicast) and to the eth2
interface (using server's global address 2000::546). Also clients must
use multicasts (the default approach):

\begin{Verbatim}
# relay.conf
iface eth0 {
  server multicast yes
}
iface eth2 {
  server unicast 2000::456
}
iface eth1 {
  client multicast yes                    
  interface-id 1000
}
iface eth3 {
  client multicast yes                    
  interface-id 1001
}
\end{Verbatim}

\subsubsection{Example 3: 2 relays}
Those two configuration files correspond to the ,,2 relays'' example
provided in the server example 8. See \ref{features-relays} for details.

\begin{Verbatim}
# relay.conf - relay 1
log-level 8
log-mode full

# messages will be forwarded on this interface using multicast
iface eth2 {
   server multicast yes    // relay messages on this interface to ff05::1:3
 # server unicast 6000::10 // relay messages on this interface to this global address
}

iface eth1 {
#  client multicast yes    // bind ff02::1:2
  client unicast 6011::1   // bind this address
  interface-id 6011
}
\end{Verbatim}

\begin{Verbatim}
# relay.conf - relay 2
iface eth0 {
#   server multicast yes  // relay messages on this interface to ff05::1:3
  server unicast 6011::1  // relay messages on this interface to this global address
}

# client can send messages to multicast 
# (or specific link-local addr) on this link
iface eth1 {
  client multicast yes    // bind ff02::1:2
# client unicast 6021::1  // bind this address
  interface-id 6021
}
\end{Verbatim}
